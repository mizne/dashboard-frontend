<div class="tag-overview-container">
  <nz-card>
    <form nz-form [formGroup]="form" (ngSubmit)="submitForm()" [nzLayout]="'inline'">

      <nz-form-item>
        <nz-form-label nzFor="interval">周期</nz-form-label>
        <nz-form-control>
          <nz-radio-group formControlName="interval">
            <label nz-radio-button *ngFor="let item of intervals" [nzValue]="item.name">{{item.name}}</label>
          </nz-radio-group>
        </nz-form-control>
      </nz-form-item>

      <nz-form-item>
        <nz-form-label nzFor="latestIntervals">倒数第几个周期({{intervalTime$ | async | date:'MM-dd HH:mm'}})</nz-form-label>
        <nz-form-control>
          <nz-input-number formControlName="latestIntervals" [attr.id]="'latestIntervals'" [nzMin]="1" [nzStep]="1">
          </nz-input-number>
        </nz-form-control>
      </nz-form-item>

      <nz-form-item class="search-area">
        <nz-form-control>
          <button nz-button [nzType]="'primary'">搜索</button>
          <button nz-button type="button" (click)="resetForm()" style="margin-left: 12px">重置</button>
        </nz-form-control>
      </nz-form-item>

      <nz-form-item class="register-area" style="display: flex;align-items: center;justify-content: center;">
        <update-time [status]="status"></update-time>
      </nz-form-item>
    </form>
  </nz-card>

  <div class="tag-overview-content" style="margin-top: 12px">
    <nz-spin [nzSpinning]="loading"></nz-spin>

    <div *ngIf="totalMarketTagDailyItem" nz-row>
      <nz-spin [nzSpinning]="loading">
        <nz-card style="width:100%; margin-bottom: 12px;">
          <div nz-row>
            <div nz-col nzSpan="12"
              style="display: flex;justify-content: space-evenly;flex-direction: column;font-size: 16px;font-weight: bold;">
              <div style="margin-bottom: 6px;">
                <span>总交易量: {{totalMarketTagDailyItem.volume | currency}}</span>
                <span [title]="'相对前 ' + totalMarketTagDailyItem.volumeIntervals + ' 周期平均值'" style="margin-right: 16px">
                  总交易量变动:
                  <nz-tag *ngIf="totalMarketTagDailyItem.volumeMultiple >= 3; else normalVolume" nzColor="error">
                    {{totalMarketTagDailyItem.volumeMultiple |
                    percent}}</nz-tag>

                  <ng-template #normalVolume>
                    <nz-tag nzColor="default">
                      {{totalMarketTagDailyItem.volumeMultiple | percent}}</nz-tag>
                  </ng-template>
                </span>
              </div>

              <div *ngIf="totalMarketTagDailyItem.volumePercents && totalMarketTagDailyItem.volumePercents.length > 0">
                <span [title]="'共 ' + totalMarketTagDailyItem.tokenNames.length + ' tokens'">占比: </span>
                <span nz-icon nzType="bars" nzTheme="outline"
                  (click)="showVolumePercentRankingModal(tokenTagNameOfTotalMarket)" [title]="'查看所有排行'"
                  style="margin-right: 6px; cursor:pointer"></span>
                <span *ngFor="let p of totalMarketTagDailyItem.volumePercents.slice(0, 10)" class="token-item"
                  style="margin-bottom: 12px; font-size: 12px;">
                  <symbol-item [symbol]="p.token" style="margin-right: 4px"></symbol-item>
                  <nz-tag *ngIf="p.percent >= 0.5; else normalTokenPercent" nzColor="error">{{p.percent |
                    percent}}</nz-tag>

                  <ng-template #normalTokenPercent>
                    <nz-tag nzColor="default">
                      {{p.percent | percent}}</nz-tag>
                  </ng-template>
                </span>
              </div>

              <div *ngIf="volumePercentRankingOfTotalMarket.length > 0">
                <span [title]="'共 ' + totalMarketTagDailyItem.tokenNames.length + ' tokens'">排行异动: </span>
                <span *ngFor="let p of volumePercentRankingOfTotalMarket" class="token-item"
                  style="margin-bottom: 12px; font-size: 12px;">
                  <symbol-item [symbol]="p.symbol" style="margin-right: 4px"></symbol-item>
                  <nz-tag [nzColor]="p.delta > 0 ? 'green' : (p.delta < 0 ? 'red' : 'default')">{{ (p.delta >= 0 ? '+' :
                    '') +
                    p.delta}}</nz-tag>
                </span>
              </div>

            </div>
            <div nz-col nzSpan="12" style="display: flex; justify-content: center; align-items: center;">
              <small-chart [data]="totalMarketTagDailyItem.volumes180Interval" type="bar" [width]="500" [height]="140"
                [showAxis]="false">
              </small-chart>
            </div>
          </div>
        </nz-card>
      </nz-spin>

    </div>

    <div nz-row>
      <div nz-col nzSpan="6" *ngFor="let item of otherTagDailyItems"
        style="display: flex; justify-content: center; align-items: center;">
        <nz-spin [nzSpinning]="loading">
          <nz-card style="width:300px; margin-bottom: 8px" [nzTitle]="item.label">
            <div style="margin-bottom: 4px">总交易量: {{item.volume | currency}}</div>
            <div style="margin-bottom: 4px" [title]="'相对前 ' + item.volumeIntervals + ' 周期平均值'">
              总交易量变动:
              <nz-tag *ngIf="item.volumeMultiple >= 3; else normalVolume" nzColor="error">{{item.volumeMultiple |
                percent}}</nz-tag>

              <ng-template #normalVolume>
                <nz-tag nzColor="default">
                  {{item.volumeMultiple | percent}}</nz-tag>
              </ng-template>
            </div>
            <div style="margin-bottom: 4px" [title]="'共 ' + item.tokenNames.length + ' tokens'"
              *ngIf="item.volumePercents && item.volumePercents.length > 0">
              <span>交易量占比: </span>
              <span nz-icon nzType="bars" nzTheme="outline" (click)="showVolumePercentRankingModal(item.name)"
                [title]="'查看所有排行'" style="margin-right: 6px; cursor:pointer"></span>
              <div *ngFor="let p of item.volumePercents.slice(0, 3)" class="token-item"
                style="margin-bottom: 4px; font-size: 12px;">
                <symbol-item [symbol]="p.token" style="margin-right: 12px"></symbol-item>
                <nz-tag *ngIf="p.percent >= 0.5; else normalTokenPercent" nzColor="error">{{p.percent |
                  percent}}</nz-tag>

                <ng-template #normalTokenPercent>
                  <nz-tag nzColor="default">
                    {{p.percent | percent}}</nz-tag>
                </ng-template>
              </div>
            </div>

            <small-chart [data]="item.volumes180Interval" type="bar" [width]="250" [height]="80" [showAxis]="false">
            </small-chart>
          </nz-card>
        </nz-spin>
      </div>
    </div>
  </div>


  <nz-modal [(nzVisible)]="showVolumePercentRanking" [nzTitle]="volumePercentRankingModalTitle" [nzFooter]="null"
    (nzOnCancel)="showVolumePercentRanking=false">
    <ng-container *nzModalContent>
      <div class="modal-list-header">
        <span style="width: 30%">symbol</span>
        <span style="width: 30%">占比</span>
        <span style="max-width: 40%">排行变动</span>
      </div>
      <nz-list nzBordered nzSize="small" style="max-height: 70vh;overflow: auto;">
        <!-- <nz-list-header>Header</nz-list-header> -->
        <nz-list-item *ngFor="let item of volumePercentRankingItems; let i = index;">
          <ranking-item [index]="i" [symbol]="item.symbol" [percent]="item.percent" [prevPercent]="item.prevPercent"
            [color]="item.color" [text]="item.text" style="width:100%"></ranking-item>
        </nz-list-item>
        <!-- <nz-list-footer>Footer</nz-list-footer> -->
      </nz-list>
      <div class="modal-list-footer">
        <span style="width: 30%">{{'共 ' + volumePercentRankingItems.length}}</span>
        <span style="width: 20%">100%</span>
        <span style="max-width: 40%">{{volumePercentRankingDescription}}</span>
      </div>
    </ng-container>
  </nz-modal>
</div>
<style>
  .modal-list-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    color: rgba(0, 0, 0, 0.85);
    padding: 8px 16px;
    border-top: 1px solid #d9d9d9;
    border-left: 1px solid #d9d9d9;
    border-right: 1px solid #d9d9d9;
    border-radius: 2px;
  }

  .modal-list-footer {
    display: flex;
    justify-content: space-between;
    align-items: center;
    color: rgba(0, 0, 0, 0.85);
    padding: 8px 16px;
    border-bottom: 1px solid #d9d9d9;
    border-left: 1px solid #d9d9d9;
    border-right: 1px solid #d9d9d9;
    border-radius: 2px;
  }
</style>